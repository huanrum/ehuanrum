!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.$ehr=n()}(this,function(e){"use strict";function n(e,t){if("string"!=typeof(e=e||""))return void("function"==typeof e&&window?(window.addEventListener("load",e),"function"==typeof t&&window.addEventListener("beforeunload",t)):"boolean"==typeof e?l.binding=e:"number"==typeof e?l.version=e:f(e,t));if(e=e.trim().replace(/_/g,"."),">"===e[0])return l.temp[e.slice(1)];if(!t){if(!Object.getOwnPropertyNames(l.data).length){var r=l.temp;l.temp={},Object.keys(r).sort(function(e,n){return e.length-n.length}).forEach(function(e){l.temp[e]=r[e]})}if(!e)return l.data;if(l.temp[e]){var o,i=e.split("."),a=i.pop(),c=l.data;for(t=l.temp[e];i.length;)o=i.shift(),c=c[o]=c[o]||{};if(!c[a]&&t)if("function"==typeof t||t instanceof Array&&"function"==typeof t[t.length-1]){var u=[];if("function"==typeof t){var p=t.toLocaleString().slice(t.toLocaleString().indexOf("(")+1,t.toLocaleString().indexOf(")"));u=p?p.split(","):[]}else{var s=t.pop();u=t,t=s}for(var d=0;d<u.length;d++)"self"===u[d].trim().toLocaleLowerCase()?u[d]=l.data[e.split(".")[0]]:u[d]=n(u[d].trim());c[a]=t.apply(t,u)}else c[a]=t}for(var y in l.temp)y!==e&&function(e,n){for(var t=0;t<n.length;t++)if(e[t]!==n[t])return!1;return!0}(y.split("."),e.split("."))&&n(y);for(var v=e.split("."),m=l.data;v.length>1;)m=m[v.shift()];return m[v.shift()]}if("."===e[e.length-1]){var h=t;e=e.slice(0,e.length-1),t=function(){return h}}l.temp[e]=t}function t(e){return e=e.replace(/\$\S*\$/,""),e.split(/\s+/).map(function(e){return e[0].toLocaleUpperCase()+e.slice(1)}).join("")}function r(e){var n=[];return function(t){if("function"==typeof t&&1===arguments.length)n.push(t);else{var r=arguments;n.forEach(function(n){n.apply(e,r)})}}}function o(e,t,r,i){function a(e,t,r){return n("menuAction")?function(){n("menuAction")(r,e,t)}:(t.style.display=new RegExp("#"+(i||"")+"/"+r).test(location.hash)?"block":"none",function(){Array.prototype.forEach.call(this.parentNode.parentNode.children,function(e){Array.prototype.forEach.call(e.getElementsByTagName("UL"),function(e){e.style.display="none"})}),t.style.display="none"===t.style.display?"block":"none"})}function c(e,o,i){var a=document.createElement("span");return a.innerHTML=n("filter")(e),n("filter.menu")&&(a.innerHTML=n("filter.menu")(a.innerHTML,e)),a.addEventListener("click",function(){location.hash!=="#"+i&&(location.hash="#"+i,r(i,e))}),t[i]=o,a}var f=document.createElement("ul");return Object.keys(e).forEach(function(n){var u=document.createElement("div"),l=c(n,e[n],(i||"")+"/"+n.replace(/\$\S*\$/,""));if(f.appendChild(u),u.appendChild(l),Object.keys(e).length){var p=o(e[n],t,r,(i||"")+"/"+n.replace(/\$\S*\$/,""));u.appendChild(p),l.addEventListener("click",a(l,p,n.replace(/\$\S*\$/,"")))}}),f}function i(e,n){if(n in e)for(;e;){if(Object.getOwnPropertyDescriptor(e,n))return Object.getOwnPropertyDescriptor(e,n);e=e.__proto__}return{}}function a(e,n,t){function r(e,n){var r=i(e,n);Object.defineProperty(e,n,{configurable:!0,enumerable:r.enumerable,set:function(e){r.set?r.set(e):r.value=e,t()},get:function(){return r.get&&r.get()||r.value}})}n.replace(/\'((?!\').)*\'/g,"").split(/[+\-*\/%\|\&\(\)=\?\:,!><]/).filter(function(e){return!!e.trim()}).forEach(function(n){/\[.*\]/.test(n)&&n.match(/\[[0-9a-zA-Z\.]*\]/g).forEach(function(t){n=n.replace(t,"."+c(e,t.replace(/[\[\]]/g,"")))});var t=e;n.split(".").forEach(function(e){r(t,e),t=t[e]||{}})})}function c(n,t,r){function o(e,n,t){n=n||"";var r=n.trim().split(".");if(e){if(e instanceof HTMLElement&&!r[0]in e&&e.hasAttribute(r[0])){var a=e.attributes[r[0]];return r[0]="value",o(a,r.join("."),t)}if(n instanceof Array){for(var c=0;c<n.length;c++)if("number"==typeof e[n[c]]||e[n[c]])return e[n[c]];return"object"!=typeof e?e:null}for(;r.length>1;)r[0].trim()?e=i(e,r.shift(),!0):r.shift();if(void 0===t)return i(e,r.shift(),!1);i(e,r.shift(),!0,t)}}function i(e,n,t,r){if(/\[\d+\]/.test(n)){var o=n.replace(/\[\d+\]/g,"");o&&(e=e[o]=e[o]||[]),Array.prototype.map.call(n.match(/\[\d+\]/g),function(n,o,i){if(n=n.replace("[","").replace("]",""),o<i.length-1)e=e[n]=e[n]||[];else{if(!t)return e[n];e=e[n]=void 0!==r?r:e[n]||{}}})}else{if(!t)return e[n];void 0===r?e[n]||(e[n]={}):e[n]=r,e=e[n]}return e}return/^[0-9a-zA-Z\._$@]*$/.test(t)?o(n,t,r):e(n,t,o)}function f(e,t,o,p){function s(e,n,t){var r=t,o=t;return t instanceof Array||(r=Object.keys(t),o=Object.values(t)),o.forEach(function(t,o){var i=r[o],a=c(e,i);Object.defineProperty(e,i,{configurable:!0,enumerable:!0,set:function(e){c(n,t,e)},get:function(){return c(n,t)}}),Object.defineProperty(n,t,{configurable:!0,enumerable:!0,set:function(e){a=e},get:function(){return a}})}),n}function d(e){var r=n("control");Array.prototype.filter.call(e.attributes||[],function(e){return/^\[.+\]$/.test(e.name)}).sort(function(e,n){return/:/.test(n.name)-/:/.test(e.name)}).forEach(function(n){!/:/.test(n.name)&&c(r,n.name.slice(1,-1))?c(r,n.name.slice(1,-1).replace(/[_\-]/g,".")).call({defineProperty:a},e,t,n.value):u(e,t,m(n.name.slice(1,-1)),n.value),l.binding||e.removeAttribute(n.name)}),e.parentNode&&y.apply(e,e.children)}function y(){Array.prototype.forEach.call(arguments,function(e){e.scope?e.scope()!==t&&t!==window&&(e.scope().__proto__=t,t.$eval(e.scope().$eval)):f(e,t)})}function v(e,n){e.scope=function(){return n},e.update=function(n){e instanceof Array?e.forEach(function(e){n?n.appendChild(e):e.parentNode&&e.parentNode.removeChild(e)}):n?n.appendChild(e):e.parentNode&&e.parentNode.removeChild(e)}}function m(e){var n={class:"className",fontsize:"fontSize",innerhtml:"innerHTML"};Object.keys(n);return Object.keys(n).forEach(function(t){e=e.replace(t,n[t])}),e}if("string"==typeof o?(l.content.innerHTML="",location.hash="#"+o.replace(/\./g,"/"),o=null):"function"==typeof o&&(p=o,o=null),"string"==typeof e[0]&&"object"==typeof e[1]&&(Object.keys(e[1]).forEach(function(n){e[0]=e[0].replace(new RegExp("\\{\\s*"+n+"\\s*\\}","g"),e[1][n]||"")}),e=e[0]),"string"==typeof e&&(e=function(e){var n=document.createElement("div");return n.innerHTML=e,Array.prototype.slice.call(n.children,0)}(e),e.forEach(function(e){(o||l.content).appendChild(e)})),!(e instanceof Array||e instanceof HTMLElement))throw new Error("element必须是DOM元素。");return"function"==typeof t&&(p=t,t={}),function(){if(!t.$eval||t.$eval===t.__proto__.$eval){if(Object.defineProperty(t,"$id",{value:++l.binding$id}),Object.defineProperty(t,"$destroy",{value:r(t)}),Object.defineProperty(t,"$eval",{value:r(t)}),Object.defineProperty(t,"$real",{value:function(){return JSON.parse(JSON.stringify(t)||"null")}}),Object.defineProperty(t,"$extend",{value:function(e,n){return s(t,e,n)}}),p&&p(t,e),t===window)return;Object.keys(t).filter(function(e){return"function"!=typeof t[e]&&!(t[e]instanceof Node)}).forEach(function(e){var n=t[e],r=i(t,e)||{};Object.defineProperty(t,e,{configurable:!0,enumerable:r.enumerable,set:function(e){n=e,r.set&&r.set(e),t.$eval()},get:function(){var e=r.get&&r.get();return"number"==typeof e?e:e||n}})})}}(),e instanceof Array?e.forEach(function(e){d(e),v(e,t)}):d(e),v(e,t),t.$eval(),e}function u(e,t,r,o){function u(){var i=/\|\s*[0-9a-zA-Z_$@]+\s*\(?\S*\)?/g,a=c(t,o.replace(i,""));o.match(i)&&o.match(i).forEach(function(e){var r=n("filter."+e.split("(")[0].replace("|","").trim());if(r)if(e.split(/[\(\)]/g)[1]){var o=e.split(/[\(\)]/g)[1].split(",").map(function(e){return c(t,e.trim())});a=r.apply(n("filter"),[a].concat(o))}else a=r(a)}),c(e,r,a)}e.parentNode&&(/^\s*on/.test(r)?function(){function n(n){t.$event=n||window.event,t.$element=e;var r=c(t,o);return delete t.$event,delete t.$element,r}if("onload"===r){var i=n();/^[0-9a-zA-Z\._$@]*$/.test(o)&&i&&i.call(t,e)}else e.addEventListener(r.replace("on","").trim(),function(e){var r=n(e);/^[0-9a-zA-Z\._$@]*$/.test(o)&&r&&r.apply(t,arguments)})}():/\S+:\S+/.test(r)?function(n){function a(e){function r(e,n){return"length"in e?Array.prototype.map.call(e,n):e&&"object"==typeof e?Array.prototype.map.call(Object.keys(e),function(t){return n(e[t],t,e)}):[]}u.forEach(function(n){e.some(function(e){return n.t===e})||n.e.update()}),u=r(e,function(o,i){var a=(u.filter(function(e){return e.t===o})[0]||{}).e;if(a)a.scope().$eval();else{var s={$index:i};"number"==typeof i&&Object.defineProperty(s,"$index",{enumerable:!1,get:function(){return r(c(t,n[1]),function(e){return""+e}).indexOf(""+o)}}),Object.defineProperty(s,n[0],{configurable:!0,enumerable:!0,get:function(){return e[i]},set:function(n){e[i]=n}}),s.__proto__=t,a=f(d,s),t.$eval(s.$eval)}return a.forEach(function(e){l?l.before?l.before(e):p.insertBefore&&p.insertBefore(e,l):p.appendChild(e)}),{t:o,e:a}})}var u=[],l=e.nextSibling,p=e.parentNode,s=i(t,o||n[1]),d=e.outerHTML.replace("["+r+']=""',"");e.parentNode.removeChild(e),s.value=s.value||[],Object.defineProperty(t,n[1],{configurable:!0,enumerable:s.enumerable,get:function(){return s.get&&s.get()||s.value},set:function(e){s.set?s.set(e):s.value=e,a(e)}}),a(c(t,o||n[1]))}(r.split(":")):/^[0-9a-zA-Z\._$@]*$/.test(o)?"function"==typeof c(t,o)?c(e,r,c(t,o)):function(){var n=o.split("."),a=n.pop(),f=i(n.length?c(t,n.join(".")):t,a)||{};t.$eval(function(){c(e,r,c(t,o))}),Object.defineProperty(n.length?c(t,n.join(".")):t,a,{configurable:!0,enumerable:f.enumerable,set:function(n){c(e,r,n),f.set&&f.set(n)},get:function(){return"value"===r&&e.value||f.get&&f.get()}}),"value"===r?e.addEventListener("keyup",function(){c(t,o,c(e,r)),t.$eval()}):e.addEventListener("click",function(){c(t,o,c(e,r))})}():(a(t,o,u),t.$eval(u)))}var l={temp:{},data:{},load:[],binding$id:0};return window&&(l.menu=document.createElement("div"),l.content=document.createElement("div"),l.menu.className="ehuanrum-menu",l.content.className="ehuanrum-content",window.addEventListener("load",function(){function e(){n("router")?(document.body.appendChild(l.menu),document.body.appendChild(l.content),t("/"+a.filter(function(e){return!!e}).join("/"),a.pop()||a.pop())):document.body.appendChild(l.content)}function t(e){"string"==typeof e?(arguments[0]=r[e.replace(/^\s*router\./,"/")],t.apply(this,arguments)):"function"==typeof e&&(l.content.innerHTML="",i&&i.scope()&&i.scope().$destroy(),i=e.apply(this,Array.prototype.slice.call(arguments,1)))}var r={},i=null,a=location.hash.replace("#","").split("/");f(document.body,window),l.menu.appendChild(o(n("router")||{},r,t,"")),n("main")?n("main")(e):e()})),n("filter",function(){return t}),n("binding",function(){return f}),n("value",function(){return c}),function(){return n}}(function(_obj,_str,_valuer){with(_obj)return eval(_str)})),function(e){"use strict";e("functions.color",function(){return function(e){if(e)return"number"!=typeof e&&(e=0,Array.prototype.forEach.call(""+e,function(n){e+=n.charCodeAt()})),"#"+new Date(1e4).setYear(e).toString(16).slice(-8,-2);for(var n=Math.floor(256*Math.random()*256*256).toString(16).slice(-6);n.length<6;)n=0+n;return"#"+n}}),e("functions.event",function(){return function(e){function n(e){return t.push(e),n}var t=[];return Object.create({in:n,out:function(e){e&&(t=t.filter(function(n){return"function"==typeof e&&n!==e||"string"==typeof e&&n.name!==e}))},fire:function(){var n=arguments;t.forEach(function(t){t.apply(e,n)})}})}})}(window.$ehr);