$ehr(!0),$ehr("global",["common_dialog",function(e){var n={service:{seto:"http://192.168.1.248:8888/mall",127:"http://127.0.0.1:8888/mall",binbin:"http://192.168.1.152:8888/mall"},websocket:{seto:"ws://192.168.1.248:8181",127:"ws://127.0.0.1:8181",binbin:"ws://192.168.1.152:8181"}},t={user:localStorage.ehuanrum_user,websocket:localStorage.ehuanrum_websocket||n.websocket.seto,service:localStorage.ehuanrum_service||n.service.seto,update:function(e,n){var t=this;Object.keys(e||{}).forEach(function(n){t[n]=e[n]}),Object.keys(e||{}).forEach(function(n){localStorage["ehuanrum_"+n]=e[n]})}};return window.document.addEventListener("keydown",function(i){if(i.altKey&&i.shiftKey&&i.ctrlKey){var o=Object.keys(localStorage).filter(function(e){return/^ehuanrum_/.test(e)}).map(function(e){return{name:e.replace("ehuanrum_",""),value:localStorage[e],options:n[e.replace("ehuanrum_","")]}});o.some(function(e){return"service"===e.name})||o.push({name:"service",value:n.service[0],options:n.service}),e(['<div [item:items] class="form-row label-value">','    <label [innerHTML]="item.name"></label>',"    <input [style.display]=\"!item.options?'inline-block':'none'\"  [value]=\"item.value\">",'    <select [style.display]="!!item.options?\'inline-block\':\'none\'" [value]="item.value"><option [op:item.options] [value]="op" [innerHTML]="$index"></select>',"</div>"].join(""),{title:"Update Config",items:o,buttons:[function(){var e={};this.items.forEach(function(n){e[n.name]=n.value,t[n.name]=n.value}),t.update(e),this.$close()}]})}}),t}]),$ehr("http",["global","binding",function(e,n){function t(e,n){var t=Object.keys(n).sort(function(e,n){return/:/.test(n.name)-/:/.test(e.name)}).map(function(t){if(e.indexOf(":"+t)===-1)return t+"="+JSON.parse(n[t]);e=e.replace(":"+t,JSON.parse(n[t]))}).filter(function(e){return!!e}).join("&");if(e.indexOf(":")===-1)return e+(t?"?"+t:"")}return function(i,o){var a=t(i,o||{}),r=n(['<div class="common-dialog-back">','   <div class="common-dialog">',"      <strong [innerHTML]=\"loadMessage + '(' +floor(remaining/2)+ 's)' + index\" [hidden]=\"!remaining\"></strong>",'      <span [hidden]="!!remaining">加载已经超时</span>',"  </div>","</div>"].join(""),{loadMessage:"加载中",index:"...",remaining:60,floor:function(e){return Math.floor(e)}},document.body,function(e){var n=0,t=setInterval(function(){n=(n+1)%16,e.index=Array(n+4).join("."),e.remaining=e.remaining-1,Math.floor(e.remaining)||setTimeout(function(){r.update()},3e3)},500);e.$destroy(function(){clearInterval(t)})});return new Promise(function(n,t){a||t({message:"参数不完整"}),fetch(e.service+a).then(function(e){return r.update(),e.json()},function(e){r.update(),t(e)}).then(function(e){n(e)})})}}]),$ehr("login",["global","binding",function(e,n){var t=['<div class="login-controller">',"   <div>","       <label>UserName</label>",'       <input [value]="username">',"   </div>","   <div>","       <label>Password</label>",'       <input [value]="password">',"   </div>",'<div><button [onclick]="login(username,password)">Login</button></div>',"</div>"].join("");return function(i,o){var a=n(t,{username:o,login:function(n,t){e.update({user:n},{user:n}),a.update(),i()}},document.body)}}]),$ehr("main",["global",function(e){return function(n){e.user?n():$ehr("login").call(this,n,"seto")}}]),$ehr("control.my.form",["binding","value","common_dialog",function(e,n,t){return function(t,i,o){var a=i.$extend({},[o]);Object.defineProperty(a,"fields",{configurable:!0,enumerable:!1,get:function(){return Object.keys(n(i,o))}}),e(['   <div class="form-body">','       <div [field:fields] class="form-row" [my.label.value]="'+o+':field">',"       </div>","   </div>"].join(""),a,t)}}]),$ehr("control.my.grid",["binding","value","common_dialog",function(e,n,t){return function(i,o,a){var r=[],s=o.$extend({select:o.select,show:function(e){t('<div [my.form]="item" style="width:20em;"></div>',{title:"展示一条数据",item:e,buttons:{ok:function(){t("提交数据")(this.$close)},cancel:function(){this.$close()}}})}},[a]);Object.defineProperty(s,"columns",{configurable:!0,enumerable:!1,set:function(e){r=e},get:function(){var e=[];return(n(o,a)||[]).forEach(function(n){Object.keys(n).forEach(function(n){e.indexOf(n)===-1&&e.push(n)})}),Object.keys(r).join()!==Object.keys(e).join()&&(s.columns=e),e}}),e(["<div >",'   <div class="table-header">','       <div class="table-row">','           <div [column:columns] [innerHTML]="column|capitalize" [class]="\'cell-\' + $index"></div>',"       </div>","   </div>",'   <div class="table-body">','       <div [item:items] class="table-row" [ondblclick]="show(item)" [onclick]="select">','           <div [column:columns] [class]="\'cell-\' + $index" [innerHTML]="item[column]|lookup(column)"></div>',"       </div>","   </div>","</div>"].join(""),s,i)}}]),$ehr("control.my.grid.menu",["binding","value",function(e,n){function t(e,n){for(var t=[],i=[],o=0;o<Math.floor(n/2);o++)t.push(o+1);for(var o=Math.floor(n/2);o<n;o++)i.push(o+1);e.befors=t,e.afters=i}return function(i,o,a){var r=(a.split(":")[0],a.split(":")[1],n(o,a.split(":")[0]+".totalPage")||1),s=o.$extend({befors:[],afters:[],goto:function(e){e===!0?e=Math.min(+n(o,a.split(":")[0]+".pageNumber")+1,n(o,a.split(":")[0]+".totalPage")):e===!1&&(e=+Math.max(n(o,a.split(":")[0]+".pageNumber")-1,1)),/^\d+$/.test(e)&&e>-1&&e-1<n(o,a.split(":")[0]+".totalPage")&&""+e!==n(o,a.split(":")[0]+".pageNumber")&&(n(o,a.split(":")[0]+".pageNumber",e),n(o,a.split(":")[1])())}},a.split(":"));Object.defineProperty(n(o,a.split(":")[0]),"totalPage",{configurable:!0,get:function(){return r},set:function(e){r=e,t(s,e)}}),t(s,n(o,a.split(":")[0]+".totalPage")),e(['   <ul class="my-grid-menu">','       <li><span [onclick]="goto(1)" [class]="(+@page@.pageNumber)===1&&\'disable\'">First</span></li>','       <li><span [onclick]="goto(false)" [class]="(+@page@.pageNumber)<2&&\'disable\'">Prev</span></li>','       <li [item:befors] [class]="(+@page@.pageNumber)===(+item)&&\'active\'"><span [onclick]="goto(item)" [innerHTML]="item"></span></li>','       <li [style.display]="@page@.totalPage<11?\'none\':\'inline-block\'"><input [value]="@page@.pageNumber" [onkeyup]="goto(@page@.pageNumber)"></li>','       <li [item:afters] [class]="(+@page@.pageNumber)===(+item)&&\'active\'"><span [onclick]="goto(item)" [innerHTML]="item"></span></li>','       <li><span [onclick]="goto(true)" [class]="(+@page@.pageNumber)>(+@page@.totalPage-1)&&\'disable\'">Next</span></li>','       <li><span [onclick]="goto(@page@.totalPage)" [class]="(+@page@.pageNumber)===(+@page@.totalPage)&&\'disable\'">Last</span></li>',"   </ul>"].join("").replace(/@page@/g,a.split(":")[0]),s,i)}}]),$ehr("control.my.label.value",["binding",function(e){return function(n,t,i){var o=t.$extend({},i.split(":"));e(['   <div class="label-value">','       <label [innerHTML]="field"></label>','       <div [innerHTML]="item[field]|lookup(field)"></div>',"   </div>"].join("").replace(/item/g,i.split(":")[0]).replace(/field/g,i.split(":")[1]),o,n)}}]),$ehr("common.dialog",["binding",function(e){function n(e,n){function t(e){var t=window.getComputedStyle(n);o.e=e,o.x=e.clientX-(parseInt(t.left)||0),o.y=e.clientY-(parseInt(t.top)||0),n.style.cursor="move",window.addEventListener("mousemove",i)}function i(e){n.style.left=e.clientX-o.x+"px",n.style.top=e.clientY-o.y+"px"}var o={};e.addEventListener("mousedown",function(e){var i=window.getComputedStyle(n);(e.clientX<(parseInt(i.left)||0)+(parseInt(i.width)||0)-15||e.clientY<(parseInt(i.top)||0)+(parseInt(i.height)||0)-15)&&t(e)}),window.addEventListener("mouseup",function(){o.e=null,n.style.cursor="default",window.removeEventListener("mousemove",i)})}return function(t,i){i=i||{},i.buttons=i.buttons||[],i.$close=function(){o.update()};var o=e([' <div class="common-dialog-back">','   <div class="common-dialog" [style.background]="background">','       <div class="common-dialog-header">',"           <label>",i.title||"no title","           </label>",'           <a [onclick]="$close">&times;</a>',"       </div>",'       <div class="common-dialog-content">',t,"       </div>",'       <div class="common-dialog-footer">','           <a [btn:buttons] [onclick]="btn" [innerHTML]="btn.name"></a>',"       </div>","   </div>"," </div>"].join(""),i,document.body);o.forEach(function(e){n(e.getElementsByClassName("common-dialog-header")[0],e.getElementsByClassName("common-dialog")[0])})}}]),$ehr("common.page",["global","binding",function(e,n){var t=["<div>",'   <div class="content-header">','        <div class="left">',"           {title} ","        </div>",'        <div class="right" [onclick]="personal">',e.user,"        </div>","   </div>",'   <div class="content-content">',"      {content}","   </div>",'   <div class="content-footer">',"       {footer}","   </div>","</div>"].join("");return function(i,o,a){if("function"==typeof o&&(a=o,o={}),"function"==typeof a&&a(o),"string"==typeof i)Object.keys(o).forEach(function(e){i=i.replace(new RegExp("\\{\\s*"+e+"\\s*\\}","g"),o[e]||"")});else if(a.update){var r=a;a=null,i='<div [my.grid]="items"></div><div [my.grid.menu]="page:update"></div>',o.page=o.page||{},o.update=function(){r.get(o.page)},r.update(function(e,n){o.items=e,Object.keys(n||{}).forEach(function(e){o.page[e]=n[e]})})}return o.personal=function(){$ehr("personal")(e.user)},n([t,{title:o.title||"no title",content:i,footer:o.footer}],o,a)}}]),$ehr("common.service",["http","functions.event",function(e,n){return function(t){var i={},o=n(),a={pageNumber:1,pageSize:20},r={update:function(e){o.in(e),i.list&&e(i.list,a)},get:function(n){return n&&e(t.url,n).then(function(e){i.list=e.data.list,Object.keys(e.data).forEach(function(n){"object"!=typeof e.data[n]&&(a[n]=e.data[n])}),o.fire(i.list,a)}),i.list},select:function(e){return e&&(i.select=e),i.select}};return r.get(a),r}}]),$ehr("filter.capitalize",function(){return function(e,n){return n=n%e.length||0,e.slice(0,n)+e[n].toLocaleUpperCase()+e.slice(n+1)}}),$ehr("filter.lookup",["http",function(e){var n={};return["/book/lookup"].forEach(function(t){e(t).then(function(e){Object.keys(e.data).forEach(function(t){var i={};e.data[t].forEach(function(e){i[e.id]=e.name}),n[t]=i})})}),function(e,t){return n[t]&&n[t][e]||e}}]),$ehr("router.book.math",["common_page","book_math_service",function(e,n){return function(){return e(null,{title:"Math"},n)}}]),$ehr("book.math.service",["common_service",function(e){return e({url:"/book/math"})}]),$ehr("router.book.story",["common_page","book_story_service",function(e,n){return function(){return e(null,{title:"Story"},n)}}]),$ehr("book.story.service",["common_service",function(e){return e({url:"/book/story"})}]),$ehr("personal",["binding","global","common_dialog",function(e,n,t){function i(e){function i(e){var n={title:e.id,messages:e.messageList,buttons:[function(){e.messageList=e.messageList.concat([{value:this.messageContent}]),a.send(JSON.stringify({to:[e.id],data:this.messageContent}))}]};Object.defineProperty(e,"messageList",{configurable:!0,get:function(){return n.messages},set:function(e){n.messages=e}}),t(['<div style="max-height:20em;overflow: auto;">',"   <div [message:messages] [innerHTML]=\"message.value\" [style.color]=\"message.get?'#d3d3d3':'#66dd66'\" [class]=\"message.get?'text-left':'text-right'\"></div>","</div>","<br>",'<textarea [value]="messageContent"></textarea>'].join(""),n)}var o={title:"connection",friends:[],messageDialog:i},a=new WebSocket(n.websocket);a.onopen=function(n){a.send(JSON.stringify({action:"login",data:e.id}))},a.onmessage=function(e){var n=JSON.parse(e.data);switch(n.action){case"login":n.from?o.friends=o.friends.concat([{id:n.from,messageList:[]}]):o.friends=n.data.map(function(e){return{id:e,messageList:[]}});break;case"logout":o.friends=o.friends.filter(function(e){return e.id!==n.from});break;default:var t=o.friends.find(function(e){return e.id===n.from});t&&(t.messageList=t.messageList.concat([{get:!0,value:n.data}]))}},t(["<div [friend:friends]>",'   <span [innerHTML]="friend.id" [onclick]="messageDialog(friend)"></span>',"</div>"].join(""),o),o.$destroy(function(){a.send(JSON.stringify({action:"logout"})),a.close()})}var o=Date.now(),a=["<div>",'   <div [innerHTML]="title"></div>',"   <div [value:item]>",'       <label [innerHTML]="$index"></label>','       <div [innerHTML]="value"></div>',"   </div>",'   <button [onclick]="connection">Connection</button>',"</div>"].join("");return function(n){e(a,function(e){e.title="个人信息",e.item={id:o,name:n,email:"huanrum@126.com"},e.connection=function(){i(e.item)}},"personal")}}]),$ehr("router.home",["common_page",function(e){var n=["<div>{brief}</div>","<br>","<div>{info}</div>","<br>","<hr>","<div>{contact}</div>"].join("");return function(){return e(n,{title:"Home"},function(e){e.brief="这是一个模拟网络商场以及产品管理的项目，里面主要包含用户个人信息，商品展示，购物车等等",e.info=["此项目中主要包含两个分块：商品展示和商品管理。","   商品展示：用户可以浏览所有商品，都可以点击购买，加入购物车，查看相信信息等等。","   商品管理：商场管理人员查看销售情况以及库存信息，分析商品的销售趋势，以便于后期的囤货。","   ","   "].join("<br>"),e.contact="email: <i>huanrum@126.com</i>"})}}]);