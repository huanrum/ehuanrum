!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.$ehr=t()}(this,function(e){"use strict";function t(e,n){if("string"!=typeof(e=e||""))return void("function"==typeof e&&window?(window.addEventListener("load",e),"function"==typeof n&&window.addEventListener("beforeunload",n)):"boolean"==typeof e?f.binding=e:"number"==typeof e?f.version=e:a(e,n));if(e=e.trim().replace(/_/g,"."),">"===e[0])return f.temp[e.slice(1)];if(!n){if(!Object.getOwnPropertyNames(f.data).length){var r=f.temp;f.temp={},Object.keys(r).sort(function(e,t){return e.length-t.length}).forEach(function(e){f.temp[e]=r[e]})}if(!e)return f.data;if(f.temp[e]){var i,o=e.split("."),c=o.pop(),u=f.data;for(n=f.temp[e];o.length;)i=o.shift(),u=u[i]=u[i]||{};if(!u[c]&&n)if("function"==typeof n||n instanceof Array&&"function"==typeof n[n.length-1]){var l=[];if("function"==typeof n){var p=n.toLocaleString().slice(n.toLocaleString().indexOf("(")+1,n.toLocaleString().indexOf(")"));l=p?p.split(","):[]}else{var s=n.pop();l=n,n=s}for(var d=0;d<l.length;d++)"self"===l[d].trim().toLocaleLowerCase()?l[d]=f.data[e.split(".")[0]]:l[d]=t(l[d].trim());u[c]=n.apply(n,l)}else u[c]=n}for(var m in f.temp)m!==e&&function(e,t){for(var n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}(m.split("."),e.split("."))&&t(m);for(var v=e.split("."),h=f.data;v.length>1;)h=h[v.shift()];return h[v.shift()]}if("."===e[e.length-1]){var y=n;e=e.slice(0,e.length-1),n=function(){return y}}f.temp[e]=n}function n(e){return e=e.replace(/\$\S*\$/,""),e.split(/\s+/).map(function(e){return e[0].toLocaleUpperCase()+e.slice(1)}).join("")}function r(e,n,i,o){function a(e,n,r){return t("menuAction")?function(){t("menuAction")(r,e,n)}:(n.style.display=new RegExp("#"+(o||"")+"/"+r).test(location.hash)?"block":"none",function(){Array.prototype.forEach.call(this.parentNode.parentNode.children,function(e){Array.prototype.forEach.call(e.getElementsByTagName("UL"),function(e){e.style.display="none"})}),n.style.display="none"===n.style.display?"block":"none"})}function c(e,r,o){var a=document.createElement("span");return a.innerHTML=t("filter")(e),t("filter.menu")&&(a.innerHTML=t("filter.menu")(a.innerHTML,e)),a.addEventListener("click",function(){location.hash!=="#"+o&&(location.hash="#"+o,i(o,e))}),n[o]=r,a}var f=document.createElement("ul");return Object.keys(e).forEach(function(t){var u=document.createElement("div"),l=c(t,e[t],(o||"")+"/"+t);if(f.appendChild(u),u.appendChild(l),Object.keys(e).length){var p=r(e[t],n,i,(o||"")+"/"+t);u.appendChild(p),l.addEventListener("click",a(l,p,t))}}),f}function i(e,t){if(t in e)for(;e;){if(Object.getOwnPropertyDescriptor(e,t))return Object.getOwnPropertyDescriptor(e,t);e=e.__proto__}return{}}function o(t,n,r){function i(e,t,n){t=t||"";var r=t.trim().split(".");if(e){if(e instanceof HTMLElement&&!r[0]in e&&e.hasAttribute(r[0])){var a=e.attributes[r[0]];return r[0]="value",i(a,r.join("."),n)}if(t instanceof Array){for(var c=0;c<t.length;c++)if("number"==typeof e[t[c]]||e[t[c]])return e[t[c]];return"object"!=typeof e?e:null}for(;r.length>1;)r[0].trim()?e=o(e,r.shift(),!0):r.shift();if(void 0===n)return o(e,r.shift(),!1);o(e,r.shift(),!0,n)}}function o(e,t,n,r){if(/\[\d+\]/.test(t)){var i=t.replace(/\[\d+\]/g,"");i&&(e=e[i]=e[i]||[]),Array.prototype.map.call(t.match(/\[\d+\]/g),function(t,i,o){if(t=t.replace("[","").replace("]",""),i<o.length-1)e=e[t]=e[t]||[];else{if(!n)return e[t];e=e[t]=void 0!==r?r:e[t]||{}}})}else{if(!n)return e[t];void 0===r?e[t]||(e[t]={}):e[t]=r,e=e[t]}return e}return/^[0-9a-zA-Z\._$@]*$/.test(n)?i(t,n,r):e(t,n,i)}function a(e,n,r){function u(){Array.prototype.forEach.call(arguments,function(e){e.scope?e.scope()!==n&&n!==window&&(e.scope().__proto__=n):a(e,n)})}function l(e){var t={class:"className",fontsize:"fontSize",innerhtml:"innerHTML"};Object.keys(t);return Object.keys(t).forEach(function(n){e=e.replace(n,t[n])}),e}if("string"==typeof e&&(e=function(e){var t=document.createElement("div");return t.innerHTML=e,t.children[0]}(e),(r||f.content).appendChild(e)),!e instanceof HTMLElement)throw new Error("element必须是DOM元素。");return function(){if(!n.$eval||n.$eval===n.__proto__.$eval){if(Object.defineProperty(n,"$id",{value:++f.binding$id}),Object.defineProperty(n,"$eval",{value:[]}),Object.defineProperty(n,"$real",{value:function(){return JSON.parse(JSON.stringify(n)||"null")}}),e.apply=function(){n.$eval.forEach(function(e){e.fn()})},n===window)return;Object.keys(n).filter(function(e){return"function"!=typeof n[e]&&!(n[e]instanceof EventTarget)}).forEach(function(e){var t=n[e],r=i(n,e)||{};Object.defineProperty(n,e,{configurable:!0,enumerable:r.enumerable,set:function(e){t=e,r.set&&r.set(e),n.$eval.forEach(function(e){e.fn()})},get:function(){var e=r.get&&r.get();return"number"==typeof e?e:e||t}})})}}(),function(){var r=t("control");Array.prototype.filter.call(e.attributes||[],function(e){return/^\[.+\]$/.test(e.name)}).sort(function(e,t){return/:/.test(t.name)-/:/.test(e.name)}).forEach(function(t){!/:/.test(t.name)&&o(r,t.name.slice(1,-1))?o(r,t.name.slice(1,-1).replace(/[_\-]/g,"."))(e,n,t.value):c(e,n,l(t.name.slice(1,-1)),t.value),f.binding||e.removeAttribute(t.name)}),e.parentNode&&u.apply(e,e.children)}(),n.$eval.forEach(function(e){e.fn()}),function(e,t){e.scope=function(){return t}}(e,n),e}function c(e,n,r,c){e.parentNode&&(/^\s*on/.test(r)?function(){"IFRAME"===e.nodeName?(o(e,r,o(n,c)),o(e,r).call(n,e,r)):e.addEventListener(r.replace("on","").trim(),function(){/^[0-9a-zA-Z\._$@]*$/.test(c)?o(n,c).apply(n,arguments):o(n,c)})}():/\S+:\S+/.test(r)?function(t){function c(i){f.forEach(function(e){i.some(function(t){return e.t===t})||e.e.parentNode.removeChild(e.e)}),f=Array.prototype.map.call(i,function(c,l){var p=(f.find(function(e){return e.t===c})||{}).e;if(p)p.apply();else{var s={$index:l};Object.defineProperty(s,"$index",{enumerable:!1,get:function(){return o(n,t[1]).map(function(e){return""+e}).indexOf(""+c)}}),Object.defineProperty(s,t[0],{configurable:!0,enumerable:!0,get:function(){return i[l]},set:function(e){i[l]=e}}),s.__proto__=n,p=a(e.outerHTML.replace("["+r+']=""',""),s)}return u.before(p),{t:c,e:p}})}var f=[],u=e.nextSibling,l=i(n,t[1]);e.parentNode.removeChild(e),Object.defineProperty(n,t[1],{configurable:!0,enumerable:l.enumerable,get:function(){return l.get&&l.get()||l.value},set:function(e){l.set?l.set(e):l.value=e,c(e)}}),c(o(n,t[1]))}(r.split(":")):/^[0-9a-zA-Z\._$@]*$/.test(c)?"function"==typeof o(n,c)?o(e,r,o(n,c)):function(){var t=i(n,c)||{};n.$eval.push({eval:c,fn:function(){o(e,r,o(n,c))}}),Object.defineProperty(n,c,{configurable:!0,enumerable:t.enumerable,set:function(n){o(e,r,n),t.set&&t.set(n)},get:function(){return"value"===r&&e.value||t.get&&t.get()}}),"value"===r?e.addEventListener("keyup",function(){o(n,c,o(e,r))}):e.addEventListener("click",function(){o(n,c,o(e,r))})}():n.$eval.push({eval:c,fn:function(){var i=o(n,c.replace(/\|\s*[0-9a-zA-Z_$@]+\s*\(?\S*\)?/g,""));c.match(/\|\s*[0-9a-zA-Z_$@]+\s*\(?\S*\)?/g)&&c.match(/\|\s*[0-9a-zA-Z_$@]+\s*\(?\S*\)?/g).forEach(function(e){var r=e.split("(")[0].replace("|","").trim();if(e.split(/[\(\)]/g)[1]){var a=e.split(/[\(\)]/g)[1].split(",").map(function(e){return o(n,e.trim())});i=t("filter."+r).apply(t("filter"),[i].concat(a))}else i=t("filter."+r)(i)}),o(e,r,i)}}))}var f={temp:{},data:{},load:[],binding$id:0};return window&&(f.menu=document.createElement("div"),f.content=document.createElement("div"),f.menu.className="ehuanrum-menu",f.content.className="ehuanrum-content",window.addEventListener("load",function(){function e(t){"string"==typeof t?(arguments[0]=n[t],e.apply(this,arguments)):"function"==typeof t&&(f.content.innerHTML="",t.apply(this,Array.prototype.slice.call(arguments,1)))}var n={},i=location.hash.replace("#","").split("/");a(document.body,window),document.body.appendChild(f.menu),document.body.appendChild(f.content),f.menu.appendChild(r(t("router"),n,e,"")),e("/"+i.filter(function(e){return!!e}).join("/"),i.pop()||i.pop())})),t("filter",function(){return n}),t("binding",function(){return a}),t("value",function(){return o}),function(){return t}}(function(_obj,_str,_valuer){with(_obj)return eval(_str)})),function(e){"use strict";e("functions.color",function(){return function(e){if(e)return"number"!=typeof e&&(e=$ehr.sToint(""+e)),"#"+new Date(1e4).setYear(e).toString(16).slice(-8,-2);for(var t=Math.floor(256*Math.random()*256*256).toString(16).slice(-6);t.length<6;)t=0+t;return"#"+t}})}(window.$ehr);